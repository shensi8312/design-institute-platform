<!DOCTYPE html>
<html>
<head>
    <title>删除功能测试</title>
    <meta charset="UTF-8">
    <style>
        body { padding: 20px; font-family: Arial; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        .delete-btn { background: #ff4d4f; color: white; border: none; }
        .test-btn { background: #1890ff; color: white; border: none; }
        pre { background: #f5f5f5; padding: 10px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>删除功能调试测试</h1>
    
    <div>
        <button class="test-btn" onclick="testBasicDelete()">测试基础删除（无确认框）</button>
        <button class="test-btn" onclick="testConfirmDelete()">测试带确认框删除</button>
        <button class="test-btn" onclick="testModalDelete()">测试Modal删除</button>
    </div>
    
    <h2>测试结果：</h2>
    <pre id="result"></pre>
    
    <script>
        const log = (msg, type = '') => {
            const el = document.getElementById('result');
            const time = new Date().toLocaleTimeString();
            const className = type ? ` class="${type}"` : '';
            el.innerHTML += `<div${className}>[${time}] ${msg}</div>`;
            console.log(msg);
        };
        
        // 测试1：基础删除（无确认框）
        async function testBasicDelete() {
            log('开始测试基础删除...');
            
            try {
                // 获取引擎列表
                const res = await fetch('/api/engines');
                const data = await res.json();
                log(`找到 ${data.data.length} 个引擎`);
                
                if (data.data.length === 0) {
                    log('没有引擎可删除', 'error');
                    return;
                }
                
                const engine = data.data[0];
                log(`删除引擎: ${engine.name} (${engine.id})`);
                
                // 直接删除
                const deleteRes = await fetch(`/api/engines/${engine.id}`, {
                    method: 'DELETE'
                });
                const deleteData = await deleteRes.json();
                
                if (deleteData.success) {
                    log('✅ 删除成功!', 'success');
                } else {
                    log(`❌ 删除失败: ${deleteData.error}`, 'error');
                }
            } catch (err) {
                log(`错误: ${err.message}`, 'error');
            }
        }
        
        // 测试2：带window.confirm的删除
        function testConfirmDelete() {
            log('测试 window.confirm...');
            
            const result = window.confirm('确定要删除吗？');
            if (result) {
                log('✅ 用户点击了确定', 'success');
                testBasicDelete();
            } else {
                log('用户点击了取消');
            }
        }
        
        // 测试3：测试为什么Modal不工作
        function testModalDelete() {
            log('测试Modal相关问题...');
            
            // 检查是否有antd
            if (typeof window.antd !== 'undefined') {
                log('找到 antd 库');
                try {
                    window.antd.Modal.confirm({
                        title: '测试确认框',
                        content: '这是一个测试',
                        onOk: () => log('Modal确认'),
                        onCancel: () => log('Modal取消')
                    });
                } catch (e) {
                    log(`Modal错误: ${e.message}`, 'error');
                }
            } else {
                log('antd 未加载或不可用', 'error');
            }
            
            // 测试原生alert
            alert('如果你能看到这个，说明弹框功能正常');
            log('alert测试完成');
        }
        
        // 页面加载时显示信息
        window.onload = () => {
            log('页面加载完成');
            log('测试页面已准备好，请点击按钮测试');
        };
    </script>
</body>
</html>