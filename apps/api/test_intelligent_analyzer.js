#!/usr/bin/env node
/**
 * æµ‹è¯•æ™ºèƒ½æ–‡æ¡£åˆ†æžå™¨
 */

const IntelligentDocumentAnalyzer = require('./src/services/intelligence/IntelligentDocumentAnalyzer')

// æµ‹è¯•æ ·æœ¬ï¼šå»ºç­‘æ ‡å‡†
const sampleDocument1 = {
  title: 'CECS318-2012 è½»è´¨èŠ¯æ¨¡æ··å‡åœŸå åˆå¯†è‚‹æ¥¼æ¿æŠ€æœ¯è§„ç¨‹',
  content: `
1 æ€»åˆ™
1.0.1 ä¸ºè§„èŒƒè½»è´¨èŠ¯æ¨¡æ··å‡åœŸå åˆå¯†è‚‹æ¥¼æ¿çš„è®¾è®¡ã€æ–½å·¥åŠéªŒæ”¶ï¼Œåšåˆ°æŠ€æœ¯å…ˆè¿›ã€å®‰å…¨é€‚ç”¨ã€ç»æµŽåˆç†ã€ç¡®ä¿è´¨é‡ï¼Œåˆ¶å®šæœ¬è§„ç¨‹ã€‚

1.0.2 æœ¬è§„ç¨‹é€‚ç”¨äºŽæ°‘ç”¨å»ºç­‘å’Œä¸€èˆ¬å·¥ä¸šå»ºç­‘ä¸­è½»è´¨èŠ¯æ¨¡æ··å‡åœŸå åˆå¯†è‚‹æ¥¼æ¿çš„è®¾è®¡ã€æ–½å·¥åŠéªŒæ”¶ã€‚

1.0.3 è½»è´¨èŠ¯æ¨¡æ··å‡åœŸå åˆå¯†è‚‹æ¥¼æ¿çš„è®¾è®¡ã€æ–½å·¥åŠéªŒæ”¶é™¤åº”ç¬¦åˆæœ¬è§„ç¨‹å¤–ï¼Œå°šåº”ç¬¦åˆå›½å®¶çŽ°è¡Œæœ‰å…³æ ‡å‡†çš„è§„å®šã€‚

3 ææ–™
3.1 æ··å‡åœŸ
3.1.1 é¢„åˆ¶åº•æ¿æ··å‡åœŸå¼ºåº¦ç­‰çº§ä¸åº”ä½ŽäºŽC30ï¼›çŽ°æµ‡å±‚æ··å‡åœŸå¼ºåº¦ç­‰çº§ä¸åº”ä½ŽäºŽC25ã€‚

3.1.2 æ··å‡åœŸåº”å…·æœ‰è‰¯å¥½çš„å·¥ä½œæ€§èƒ½ï¼Œåè½åº¦å®œä¸º120mm~160mmã€‚

3.2 é’¢ç­‹
3.2.1 é’¢ç­‹åº”é‡‡ç”¨HRB400çº§æˆ–HRB335çº§çƒ­è½§é’¢ç­‹ã€‚

3.2.2 é’¢ç­‹çš„åŠ›å­¦æ€§èƒ½å’Œå·¥è‰ºæ€§èƒ½åº”ç¬¦åˆçŽ°è¡Œå›½å®¶æ ‡å‡†ã€Šé’¢ç­‹æ··å‡åœŸç”¨é’¢ ç¬¬2éƒ¨åˆ†ï¼šçƒ­è½§å¸¦è‚‹é’¢ç­‹ã€‹GB1499.2çš„è§„å®šã€‚

4 è®¾è®¡
4.1 ä¸€èˆ¬è§„å®š
4.1.1 æ¥¼æ¿è·¨åº¦ä¸å®œå¤§äºŽ9mï¼Œæ‚¬æŒ‘é•¿åº¦ä¸å®œå¤§äºŽ2.5mã€‚

4.1.2 æ¥¼æ¿è®¡ç®—åŽšåº¦ä¸åº”å°äºŽ100mmï¼Œè‚‹é—´è·ä¸åº”å¤§äºŽ600mmï¼Œè‚‹å®½ä¸åº”å°äºŽ60mmã€‚

4.2 è·è½½
4.2.1 æ¥¼æ¿è®¾è®¡åº”è€ƒè™‘æ°¸ä¹…è·è½½ã€æ¥¼é¢æ´»è·è½½ã€æ–½å·¥è·è½½ç­‰ã€‚

4.2.2 æ–½å·¥é˜¶æ®µåº”éªŒç®—é¢„åˆ¶åº•æ¿çš„æ‰¿è½½åŠ›ï¼Œæ–½å·¥è·è½½æ ‡å‡†å€¼ä¸åº”å°äºŽ1.0kN/mÂ²ã€‚

5 æ–½å·¥
5.1 é¢„åˆ¶åº•æ¿
5.1.1 é¢„åˆ¶åº•æ¿ç”Ÿäº§åº”åœ¨å…·æœ‰ç›¸åº”èµ„è´¨çš„é¢„åˆ¶æž„ä»¶åŽ‚è¿›è¡Œã€‚

5.1.2 é¢„åˆ¶åº•æ¿åŠè£…å‰ï¼Œæ··å‡åœŸå¼ºåº¦åº”è¾¾åˆ°è®¾è®¡å¼ºåº¦çš„75%ä¸”ä¸ä½ŽäºŽ15MPaã€‚

5.2 çŽ°æµ‡å±‚æ–½å·¥
5.2.1 æµ‡ç­‘æ··å‡åœŸå‰åº”æ¸…ç†é¢„åˆ¶åº•æ¿è¡¨é¢ï¼Œä¿æŒæ¹¿æ¶¦ã€‚

5.2.2 æ··å‡åœŸåº”è¿žç»­æµ‡ç­‘ï¼Œæµ‡ç­‘è¿‡ç¨‹ä¸­åº”æŒ¯æ£å¯†å®žï¼Œä¸å¾—æ¼æŒ¯ã€‚

6 è´¨é‡éªŒæ”¶
6.1 é¢„åˆ¶åº•æ¿
6.1.1 é¢„åˆ¶åº•æ¿çš„å°ºå¯¸åå·®åº”ç¬¦åˆè¡¨6.1.1çš„è§„å®šã€‚

è¡¨6.1.1 é¢„åˆ¶åº•æ¿å°ºå¯¸åå·®
é¡¹ç›®          å…è®¸åå·®(mm)
é•¿åº¦          Â±5
å®½åº¦          Â±5
åŽšåº¦          +5, -3
å¹³æ•´åº¦        3

6.2 çŽ°æµ‡å±‚
6.2.1 çŽ°æµ‡å±‚æ··å‡åœŸå¼ºåº¦åº”ç¬¦åˆè®¾è®¡è¦æ±‚ï¼Œä¸”åŒæ¡ä»¶å…»æŠ¤è¯•ä»¶å¼ºåº¦ä¸åº”ä½ŽäºŽè®¾è®¡å¼ºåº¦çš„95%ã€‚
  `
}

// æµ‹è¯•æ ·æœ¬ï¼šè£…é…å¼æ ‡å‡†
const sampleDocument2 = {
  title: 'CECS396-2015 è£…é…å¼çŽ»çº¤å¢žå¼ºæ— æœºææ–™å¤åˆä¿æ¸©å¢™æ¿åº”ç”¨æŠ€æœ¯è§„ç¨‹',
  content: `
1 æ€»åˆ™
1.0.1 ä¸ºè§„èŒƒè£…é…å¼çŽ»çº¤å¢žå¼ºæ— æœºææ–™å¤åˆä¿æ¸©å¢™æ¿çš„è®¾è®¡ã€åˆ¶ä½œã€å®‰è£…åŠéªŒæ”¶ï¼Œç¡®ä¿å·¥ç¨‹è´¨é‡å’Œå®‰å…¨ï¼Œåˆ¶å®šæœ¬è§„ç¨‹ã€‚

3 ææ–™æ€§èƒ½
3.1 é¢æ¿
3.1.1 é¢æ¿æŠ—æŠ˜å¼ºåº¦ä¸åº”ä½ŽäºŽ15MPaã€‚
3.1.2 é¢æ¿æŠ—å†²å‡»æ€§èƒ½åº”ç¬¦åˆGB/T 7019è§„å®šï¼Œè½çƒå†²å‡»è¯•éªŒé«˜åº¦ä¸åº”å°äºŽ500mmã€‚

3.2 ä¿æ¸©èŠ¯æ
3.2.1 ä¿æ¸©èŠ¯æå¯¼çƒ­ç³»æ•°ä¸åº”å¤§äºŽ0.045W/(mÂ·K)ã€‚
3.2.2 ä¿æ¸©èŠ¯æå¯†åº¦åº”ä¸º100kg/mÂ³~150kg/mÂ³ã€‚

4 è®¾è®¡è¦æ±‚
4.1 è¿žæŽ¥è®¾è®¡
4.1.1 å¢™æ¿ä¸Žä¸»ä½“ç»“æž„çš„è¿žæŽ¥åº”é‡‡ç”¨å¯é çš„æœºæ¢°è¿žæŽ¥æ–¹å¼ã€‚
4.1.2 è¿žæŽ¥ä»¶åº”é‡‡ç”¨ä¸é”ˆé’¢æˆ–ç»é˜²è…å¤„ç†çš„é’¢æã€‚
4.1.3 æ¯å—å¢™æ¿ä¸å¾—å°‘äºŽ4ä¸ªè¿žæŽ¥ç‚¹ã€‚

4.2 æŽ¥ç¼å¤„ç†
4.2.1 å¢™æ¿é—´ç«–å‘æŽ¥ç¼å®½åº¦å®œä¸º15mm~20mmã€‚
4.2.2 æŽ¥ç¼åº”é‡‡ç”¨å¼¹æ€§å¯†å°ææ–™å¡«å……ã€‚

5 å®‰è£…æ–½å·¥
5.1 å®‰è£…å‡†å¤‡
5.1.1 å®‰è£…å‰åº”æ£€æŸ¥å¢™æ¿å¤–è§‚è´¨é‡ï¼Œä¸å¾—æœ‰è£‚çº¹ã€ç¼ºæŸç­‰ç¼ºé™·ã€‚
5.1.2 å®‰è£…åŸºé¢åº”å¹³æ•´ã€æ¸…æ´ã€å¹²ç‡¥ã€‚

5.2 å®‰è£…é¡ºåº
5.2.1 å¢™æ¿å®‰è£…åº”æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œï¼š
  1) æµ‹é‡æ”¾çº¿ï¼Œç¡®å®šå¢™æ¿ä½ç½®ï¼›
  2) å®‰è£…è¿žæŽ¥ä»¶ï¼›
  3) åŠè£…å¢™æ¿å°±ä½ï¼›
  4) ä¸´æ—¶å›ºå®šï¼›
  5) æ ¡æ­£è°ƒæ•´ï¼›
  6) æ°¸ä¹…å›ºå®šï¼›
  7) æŽ¥ç¼å¤„ç†ã€‚

5.3 å®‰è£…è¦æ±‚
5.3.1 å¢™æ¿å®‰è£…çš„åž‚ç›´åº¦åå·®ä¸åº”å¤§äºŽ3mm/å±‚é«˜ã€‚
5.3.2 ç›¸é‚»å¢™æ¿å¹³æ•´åº¦åå·®ä¸åº”å¤§äºŽ2mmã€‚
  `
}

async function testAnalyzer() {
  console.log('='.repeat(80))
  console.log('ðŸ§ª æ™ºèƒ½æ–‡æ¡£åˆ†æžå™¨æµ‹è¯•')
  console.log('='.repeat(80))

  const analyzer = new IntelligentDocumentAnalyzer()

  // æµ‹è¯•1ï¼šæ··å‡åœŸæ¥¼æ¿æŠ€æœ¯è§„ç¨‹
  console.log('\n' + '='.repeat(80))
  console.log('æµ‹è¯•1ï¼šæ··å‡åœŸæ¥¼æ¿æŠ€æœ¯è§„ç¨‹')
  console.log('='.repeat(80))

  try {
    const result1 = await analyzer.analyzeComplete(sampleDocument1)

    console.log('\nâœ… æ–‡æ¡£è¯†åˆ«ç»“æžœ:')
    console.log(`  æ–‡æ¡£ç±»åž‹: ${result1.document_info.document_type}`)
    console.log(`  ä¸“ä¸šé¢†åŸŸ: ${result1.document_info.domains.join(', ')}`)
    console.log(`  æ ‡å‡†å±‚çº§: ${result1.document_info.standard_level}`)
    console.log(`  æ ‡å‡†ç¼–å·: ${result1.document_info.standard_code}`)
    console.log(`  æ‘˜è¦: ${result1.document_info.summary}`)

    console.log('\nâœ… è§„åˆ™æå–ç»“æžœ:')
    for (const [code, data] of Object.entries(result1.extracted_rules)) {
      console.log(`  ${data.name}: ${data.rules.length} æ¡`)
      if (data.rules.length > 0) {
        console.log(`    ç¤ºä¾‹: ${data.rules[0].rule_name}`)
      }
    }

    console.log('\nâœ… çŸ¥è¯†å›¾è°±ç»Ÿè®¡:')
    console.log(`  å®žä½“æ•°é‡: ${result1.analysis_metadata.total_entities}`)
    console.log(`  å…³ç³»æ•°é‡: ${result1.analysis_metadata.total_relationships}`)
    console.log(`  è§„åˆ™æ€»æ•°: ${result1.analysis_metadata.total_rules}`)
    console.log(`  å¤„ç†æ—¶é•¿: ${result1.analysis_metadata.duration_seconds}ç§’`)

  } catch (error) {
    console.error('âŒ æµ‹è¯•1å¤±è´¥:', error.message)
  }

  // æµ‹è¯•2ï¼šè£…é…å¼å¢™æ¿è§„ç¨‹
  console.log('\n\n' + '='.repeat(80))
  console.log('æµ‹è¯•2ï¼šè£…é…å¼å¢™æ¿è§„ç¨‹')
  console.log('='.repeat(80))

  try {
    const result2 = await analyzer.analyzeComplete(sampleDocument2)

    console.log('\nâœ… æ–‡æ¡£è¯†åˆ«ç»“æžœ:')
    console.log(`  æ–‡æ¡£ç±»åž‹: ${result2.document_info.document_type}`)
    console.log(`  ä¸“ä¸šé¢†åŸŸ: ${result2.document_info.domains.join(', ')}`)
    console.log(`  æ ‡å‡†å±‚çº§: ${result2.document_info.standard_level}`)
    console.log(`  æ ‡å‡†ç¼–å·: ${result2.document_info.standard_code}`)

    console.log('\nâœ… è§„åˆ™æå–ç»“æžœ:')
    for (const [code, data] of Object.entries(result2.extracted_rules)) {
      console.log(`  ${data.name}: ${data.rules.length} æ¡`)
    }

    console.log('\nâœ… æå–çš„è£…é…è§„åˆ™ç¤ºä¾‹:')
    const assemblyRules = result2.extracted_rules.assembly_rule?.rules || []
    assemblyRules.slice(0, 3).forEach((rule, idx) => {
      console.log(`\n  è§„åˆ™ ${idx + 1}: ${rule.rule_name}`)
      console.log(`    é€‚ç”¨æ¡ä»¶: ${rule.applicable_condition}`)
      console.log(`    å…·ä½“è¦æ±‚: ${rule.requirements}`)
    })

  } catch (error) {
    console.error('âŒ æµ‹è¯•2å¤±è´¥:', error.message)
  }

  console.log('\n' + '='.repeat(80))
  console.log('âœ… æµ‹è¯•å®Œæˆï¼')
  console.log('='.repeat(80))

  process.exit(0)
}

// è¿è¡Œæµ‹è¯•
testAnalyzer().catch(error => {
  console.error('æµ‹è¯•å¤±è´¥:', error)
  process.exit(1)
})
